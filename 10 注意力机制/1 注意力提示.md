首先回顾一个经典注意力框架，解释如何在视觉场景中展开注意力。 受此框架中的_注意力提示_（attention cues）的启发， 我们将设计能够利用这些注意力提示的模型。 1964年的Nadaraya-Waston核回归（kernel regression）正是具有 _注意力机制_（attention mechanism）的机器学习的简单演示。

然后继续介绍的是注意力函数，它们在深度学习的注意力模型设计中被广泛使用。 具体来说，我们将展示如何使用这些函数来设计_Bahdanau注意力_。 Bahdanau注意力是深度学习中的具有突破性价值的注意力模型，它双向对齐并且可以微分。

最后将描述仅仅基于注意力机制的_Transformer_架构， 该架构中使用了_多头注意力_（multi-head attention） 和_自注意力_（self-attention）。 自2017年横空出世，Transformer一直都普遍存在于现代的深度学习应用中， 例如语言、视觉、语音和强化学习领域。

---

## 生物学中的注意力提示

注意力是如何应用于视觉世界中的呢？ 这要从当今十分普及的_双组件_（two-component）的框架开始讲起： 这个框架的出现可以追溯到19世纪90年代的威廉·詹姆斯， 他被认为是“美国心理学之父” :cite:`James.2007`。 在这个框架中，受试者基于_非自主性提示_和_自主性提示_ 有选择地引导注意力的焦点。

## 查询、键和值

首先，考虑一个相对简单的状况， 即只使用非自主性提示。 要想将选择偏向于感官输入， 则可以简单地使用参数化的全连接层， 甚至是非参数化的最大汇聚层或平均汇聚层。

✅ **池化（Pooling） = 汇聚（Aggregation）**
**池化 = 信息汇聚**
**平均池化 = 平均**
**最大池化 = 取最大**
**注意力池化 = 可学习的加权平均**

因此，“是否包含自主性提示”将注意力机制与全连接层或汇聚层区别开来。

在注意力机制的背景下，自主性提示被称为_查询_（query）。 给定任何查询，注意力机制通过_注意力汇聚_（attention pooling） 将选择引导至_感官输入_（sensory inputs，例如中间特征表示）。在注意力机制中，这些感官输入被称为_值_（value）。 更通俗的解释，每个值都与一个_键_（key）配对， 这可以想象为感官输入的非自主提示。

![[Pasted image 20251112004153.png]]
可以通过设计注意力汇聚的方式， 便于给定的查询（自主性提示）与键（非自主性提示）进行匹配， 这将引导得出最匹配的值（感官输入）。

## 注意力的可视化

```python
#@save
def show_heatmaps(matrices, xlabel, ylabel, titles=None, figsize=(2.5, 2.5),
                  cmap='Reds'):
    """显示矩阵热图"""
    d2l.use_svg_display()
    num_rows, num_cols = matrices.shape[0], matrices.shape[1]
    fig, axes = d2l.plt.subplots(num_rows, num_cols, figsize=figsize,
                                 sharex=True, sharey=True, squeeze=False)
    for i, (row_axes, row_matrices) in enumerate(zip(axes, matrices)):
        for j, (ax, matrix) in enumerate(zip(row_axes, row_matrices)):
            pcm = ax.imshow(matrix.detach().numpy(), cmap=cmap)
            if i == num_rows - 1:
                ax.set_xlabel(xlabel)
            if j == 0:
                ax.set_ylabel(ylabel)
            if titles:
                ax.set_title(titles[j])
    fig.colorbar(pcm, ax=axes, shrink=0.6);
```

![[PixPin_2025-11-12_14-16-00 1.png]]

## 小结

- 人类的注意力是有限的、有价值和稀缺的资源。
- 受试者使用非自主性和自主性提示有选择性地引导注意力。前者基于突出性，后者则依赖于意识。
- 注意力机制与全连接层或者汇聚层的区别源于增加的自主提示。
- 由于包含了自主性提示，注意力机制与全连接的层或汇聚层不同。
- 注意力机制通过注意力汇聚使选择偏向于值（感官输入），其中包含查询（自主性提示）和键（非自主性提示）。键和值是成对的。
- 可视化查询和键之间的注意力权重是可行的。



